"""
Pytest configuration and shared fixtures for py-chainlink-streams tests.
"""

import os
import pytest
from typing import Dict, Any


@pytest.fixture
def mock_api_credentials(monkeypatch):
    """Mock API credentials for testing."""
    monkeypatch.setenv("CHAINLINK_STREAMS_API_KEY", "test-api-key")
    monkeypatch.setenv("CHAINLINK_STREAMS_API_SECRET", "test-api-secret")
    yield
    # Cleanup (monkeypatch automatically restores)


@pytest.fixture
def clear_api_credentials(monkeypatch):
    """Clear API credentials for testing error cases."""
    monkeypatch.delenv("CHAINLINK_STREAMS_API_KEY", raising=False)
    monkeypatch.delenv("CHAINLINK_STREAMS_API_SECRET", raising=False)
    yield
    # Cleanup (monkeypatch automatically restores)


@pytest.fixture
def sample_feed_id():
    """Sample feed ID for testing (v3 schema)."""
    return "0x00039d9e45394f473ab1f050a1b963e6b05351e52d71e507509ada0c95ed75b8"


@pytest.fixture
def sample_feed_ids():
    """Sample list of feed IDs for testing."""
    return [
        "0x00039d9e45394f473ab1f050a1b963e6b05351e52d71e507509ada0c95ed75b8",
    ]


@pytest.fixture
def sample_report_response() -> Dict[str, Any]:
    """Sample API response for testing."""
    return {
        "report": {
            "feedID": "0x00039d9e45394f473ab1f050a1b963e6b05351e52d71e507509ada0c95ed75b8",
            "validFromTimestamp": 1767208232,
            "observationsTimestamp": 1767208232,
            "fullReport": "0x00094baebfda9b87680d8e59aa20a3e565126640ee7caeab3cd965e5568b17ee0000000000000000000000000000000000000000000000000000000001b5f8e0000000000000000000000000000000000000000000000000000000040000000100000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000003000000010100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000039d9e45394f473ab1f050a1b963e6b05351e52d71e507509ada0c95ed75b800000000000000000000000000000000000000000000000000000000695575280000000000000000000000000000000000000000000000000000000069557528000000000000000000000000000000000000000000000000000061d4686ab95b000000000000000000000000000000000000000000000000005cc0542829720c00000000000000000000000000000000000000000000000000000000697d022800000000000000000000000000000000000000000000128fdc41b71dc6f5d38000000000000000000000000000000000000000000000128fdbab5fad6a8bde4000000000000000000000000000000000000000000000128fe35765f5650deb000000000000000000000000000000000000000000000000000000000000000006c091a7bbcc8756175b753f0213b059555146608c40227bb43347f7684cac5d3b31308e96ad5fe258dd2d61f976674f8b8ab6214c1ff8c4319c37ea332f09b908844729d8569af48587905aadcc36b5782b82ccea539ee5fe3fafb8bd8e3e8de761f1451036f9475536f4ac1e0e2d5fe1c4c379bdb5ec9fe988f8a4b2f6ee9b30a17ca40454edcd81ec7ca1e5ce8171e2bc12f676d8752c6a942126a9e6265787f27618b6294ae92cdd5f92001931878c3e5ba59aef0d121b56a25fed3ed57db6000000000000000000000000000000000000000000000000000000000000000649c9816b22567c99a3a57b75a72791221008035025b331a8505c6943fb5c2c632e14defc916e19931a2bcd88d3a81f6d6f945aa5089f0af212e6fa19cba3e95e38778a5c3dbc207a6b83da2817a2ea60a0062e669e4ae10c6bf21ec269fd24f923a41177dcdfbd51d659c1cc88035e720e006e82e38e36fd5f0554b76b8b568912f4fb66d8fabcfb6e5c40446f1fb78e646807cab4d368c06585c405fba09ea643ce0431123487e81c8b9e487161e4713252554ed8b9027103f1c42183fa532d"
        }
    }


@pytest.fixture
def sample_decoded_report() -> Dict[str, Any]:
    """Sample decoded report for testing."""
    return {
        "reportContext": (b'\x00' * 32, b'\x00' * 32, b'\x00' * 32),
        "reportBlob": b'\x00' * 288,  # Placeholder
        "rawRs": [b'\x00' * 32],
        "rawSs": [b'\x00' * 32],
        "rawVs": b'\x00' * 32,
        "data": {
            "feedId": "0x00039d9e45394f473ab1f050a1b963e6b05351e52d71e507509ada0c95ed75b8",
            "validFromTimestamp": 1767208232,
            "observationsTimestamp": 1767208232,
            "nativeFee": 7000000000000000,
            "linkFee": 5000000000000000000,
            "expiresAt": 1767216032,
            "benchmarkPrice": 87656352262094430000000,
            "bid": 87656309944707825000000,
            "ask": 87656862768468300000000,
        },
        "schemaVersion": 3,
    }

